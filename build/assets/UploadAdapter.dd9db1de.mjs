class i{constructor(e){this.loader=e}upload(){return this.loader.file.then(e=>new Promise((r,o)=>{this._initRequest(),this._initListeners(r,o,e),this._sendRequest(e)}))}abort(){this.xhr&&this.xhr.abort()}_initRequest(){const e=this.xhr=new XMLHttpRequest;e.open("POST","/mediamanager/ckuploadImage",!0),e.responseType="json"}_initListeners(e,r,o){const s=this.xhr,n=this.loader,a=`Couldn't upload file: ${o.name}.`;s.addEventListener("error",()=>r(a)),s.addEventListener("abort",()=>r()),s.addEventListener("load",()=>{const t=s.response;if(!t||t.error)return r(t&&t.error?t.error.message:a);e({default:t.url})}),s.upload&&s.upload.addEventListener("progress",t=>{t.lengthComputable&&(n.uploadTotal=t.total,n.uploaded=t.loaded)})}_sendRequest(e){const r=new FormData;r.append("upload",e),this.xhr.send(r)}}export{i as U};
